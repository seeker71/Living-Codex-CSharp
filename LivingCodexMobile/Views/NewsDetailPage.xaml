<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="LivingCodexMobile.Views.NewsDetailPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:LivingCodexMobile.Models"
             Title="News Detail"
             x:DataType="models:NewsItem">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            
            <!-- News Header -->
            <Frame BackgroundColor="LightBlue" Padding="15">
                <StackLayout>
                    <Label Text="{Binding Title}" 
                           FontSize="20" 
                           FontAttributes="Bold" />
                    <Label Text="{Binding Source, StringFormat='Source: {0}'}" 
                           FontSize="14" 
                           TextColor="Blue" />
                    <Label Text="{Binding PublishedAt, StringFormat='Published: {0:MMMM dd, yyyy HH:mm}'}" 
                           FontSize="12" 
                           TextColor="Gray" />
                </StackLayout>
            </Frame>

            <!-- News Image -->
            <Image x:Name="NewsImage"
                   Source="{Binding ImageUrl}"
                   Aspect="AspectFit"
                   HeightRequest="200"
                   IsVisible="{Binding ImageUrl, Converter={StaticResource StringToVisibilityConverter}}" />

            <!-- Description -->
            <Frame BackgroundColor="White" Padding="15">
                <StackLayout>
                    <Label Text="Description" 
                           FontSize="16" 
                           FontAttributes="Bold" />
                    <Label Text="{Binding Description}" 
                           FontSize="14" />
                </StackLayout>
            </Frame>

            <!-- Content -->
            <Frame BackgroundColor="White" Padding="15">
                <StackLayout>
                    <Label Text="Content" 
                           FontSize="16" 
                           FontAttributes="Bold" />
                    <Label Text="{Binding Content}" 
                           FontSize="14" />
                </StackLayout>
            </Frame>

            <!-- Categories and Tags -->
            <Frame BackgroundColor="LightGray" Padding="15">
                <StackLayout>
                    <Label Text="Categories" 
                           FontSize="16" 
                           FontAttributes="Bold" />
                    <CollectionView ItemsSource="{Binding Categories}" 
>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="LightBlue" 
                                       Padding="8,4" 
                                       Margin="0,0,5,0"
                                       CornerRadius="10">
                                    <Label Text="{Binding .}" 
                                           FontSize="12" 
                                           TextColor="Blue" />
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Actions -->
            <StackLayout Orientation="Horizontal" Spacing="10">
                <Button Text="Extract Concepts" 
                        Clicked="OnExtractConceptsClicked"
                        BackgroundColor="Purple" />
                <Button Text="Related News" 
                        Clicked="OnRelatedNewsClicked"
                        BackgroundColor="Blue" />
                <Button Text="Mark as Read" 
                        Clicked="OnMarkAsReadClicked"
                        BackgroundColor="Green" />
                <Button Text="Share" 
                        Clicked="OnShareClicked"
                        BackgroundColor="Orange" />
            </StackLayout>

            <!-- Extracted Concepts Section -->
            <Frame x:Name="ConceptsSection" 
                   BackgroundColor="White" 
                   Padding="15"
                   IsVisible="False">
                <StackLayout>
                    <Label Text="Extracted Concepts" 
                           FontSize="16" 
                           FontAttributes="Bold" />
                    <CollectionView x:Name="ConceptsCollectionView" 
                                    HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:Concept">
                                <Grid Padding="10" BackgroundColor="LightGray" Margin="0,0,0,5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" 
                                           Text="{Binding Name}" 
                                           FontSize="14" 
                                           FontAttributes="Bold" />
                                    <Label Grid.Row="1" 
                                           Text="{Binding Description}" 
                                           FontSize="12" 
                                           TextColor="Gray" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Related News Section -->
            <Frame x:Name="RelatedNewsSection" 
                   BackgroundColor="White" 
                   Padding="15"
                   IsVisible="False">
                <StackLayout>
                    <Label Text="Related News" 
                           FontSize="16" 
                           FontAttributes="Bold" />
                    <CollectionView x:Name="RelatedNewsCollectionView" 
                                    HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:NewsItem">
                                <Grid Padding="10" BackgroundColor="LightGray" Margin="0,0,0,5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" 
                                           Text="{Binding Title}" 
                                           FontSize="14" 
                                           FontAttributes="Bold" />
                                    <Label Grid.Row="1" 
                                           Text="{Binding Source, StringFormat='Source: {0}'}" 
                                           FontSize="12" 
                                           TextColor="Blue" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

        </StackLayout>
    </ScrollView>
</ContentPage>
